package edu.ncsu.csc.itrust.unit.action;

import junit.framework.TestCase;
import edu.ncsu.csc.itrust.dao.DAOFactory;
import edu.ncsu.csc.itrust.dao.mysql.FamilyDAO;

import java.util.Calendar;
import java.util.List;

import edu.ncsu.csc.itrust.action.ViewMyRecordsAction;
import edu.ncsu.csc.itrust.beans.FamilyMemberBean;
import edu.ncsu.csc.itrust.beans.LabProcedureBean;
import edu.ncsu.csc.itrust.beans.ReportRequestBean;
import edu.ncsu.csc.itrust.exception.DBException;
import edu.ncsu.csc.itrust.exception.ITrustException;
import edu.ncsu.csc.itrust.unit.testutils.EvilDAOFactory;
import edu.ncsu.csc.itrust.unit.testutils.TestDAOFactory;

public class ViewMyRecordsActionTest extends TestCase {
	private ViewMyRecordsAction action;
	private DAOFactory factory = TestDAOFactory.getTestInstance();
	private DAOFactory evil = EvilDAOFactory.getEvilInstance();
	private FamilyDAO famDAO = new FamilyDAO(factory);
	private List<FamilyMemberBean> fmbList = null;
	private FamilyMemberBean fmBean = null;
	
	private long pid = 2L;
	private long hcpId = 9000000000L;

	public void testGetFamily() throws ITrustException {
		List<FamilyMemberBean> fmbList = action.getFamily();
		
		assertEquals(9, fmbList.size());
	}
	
	public void testGetReportRequests() throws ITrustException {
		List<ReportRequestBean> rrbList = action.getReportRequests();

		assertEquals(4, rrbList.size());
	}
	
	public void testDoesFamilyMemberHaveDiabetes() throws ITrustException {
		assertTrue(action.doesFamilyMemberHaveDiabetes(fmBean));
	}

	public void testDoesFamilyMemberHaveCancer() throws ITrustException {
		assertFalse(action.doesFamilyMemberHaveCancer(fmBean));
	}

	public void testDoesFamilyMemberHaveHeartDisease() throws ITrustException {
		assertFalse(action.doesFamilyMemberHaveHeartDisease(fmBean));
	}

	public void testGetSpecificLabs() throws ITrustException {
		List<LabProcedureBean> lpbList = action.getSpecificLabs(pid, "10640-1");
		
		assertEquals(1, lpbList.size());
	}
	
	public void testGetProcedures() throws DBException {
		assertEquals(1, action.getProcedures(955L).size());
		assertEquals(0, action.getProcedures(0).size());
	}
	
	public void testGetPatientAgeInMonths() throws DBException {
		action = new ViewMyRecordsAction(factory, 101L);
		Calendar testDate = Calendar.getInstance();
		//Test 9/30/2013. Patient's birthday is 5/01/13
		testDate.set(2013, 8, 30);
		assertEquals(4, action.getPatientAgeInMonths(testDate));
		//Change test date to a year after the patient's birthdate
		testDate.set(2014, 4, 1);
		assertEquals(12, action.getPatientAgeInMonths(testDate));
	}
}
