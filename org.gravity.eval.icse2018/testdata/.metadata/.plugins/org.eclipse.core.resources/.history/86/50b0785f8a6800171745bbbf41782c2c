package edu.ncsu.csc.itrust.unit.action;

import junit.framework.TestCase;
import edu.ncsu.csc.itrust.dao.DAOFactory;
import edu.ncsu.csc.itrust.dao.mysql.FamilyDAO;

import java.util.List;

import edu.ncsu.csc.itrust.action.ViewMyRecordsAction;
import edu.ncsu.csc.itrust.beans.FamilyMemberBean;
import edu.ncsu.csc.itrust.beans.LabProcedureBean;
import edu.ncsu.csc.itrust.beans.OfficeVisitBean;
import edu.ncsu.csc.itrust.beans.PatientBean;
import edu.ncsu.csc.itrust.beans.PersonnelBean;
import edu.ncsu.csc.itrust.exception.ITrustException;
import edu.ncsu.csc.itrust.unit.datagenerators.TestDataGenerator;
import edu.ncsu.csc.itrust.unit.testutils.EvilDAOFactory;
import edu.ncsu.csc.itrust.unit.testutils.TestDAOFactory;

public class ViewMyRecordsActionTest extends TestCase {
	private ViewMyRecordsAction action;
	private DAOFactory factory = TestDAOFactory.getTestInstance();
	private DAOFactory evil = EvilDAOFactory.getEvilInstance();
	private FamilyDAO famDAO = new FamilyDAO(factory);
	private List<FamilyMemberBean> fmbList = null;
	private FamilyMemberBean fmBean = null;
	
	private long pid = 2L;
	private long hcpId = 9000000000L;

	@Override
	protected void setUp() throws Exception {
		TestDataGenerator gen = new TestDataGenerator();
		gen.clearAllTables();
		gen.standardData();

		action = new ViewMyRecordsAction(factory, pid);
		fmbList = famDAO.getParents(5);
		fmBean = fmbList.get(0);
	}

	public void testViewMyRecords() throws Exception {
		assertEquals(pid, action.getPatient().getMID());
		assertEquals(2, action.getAllergies().size());
		assertEquals(9, action.getFamily().size());
		assertEquals(2, action.getAllHealthRecords().size());
		assertEquals(12, action.getAllOfficeVisits().size());
		assertEquals(6, action.getRepresented().size());
		assertEquals(0, action.getRepresenting().size());
		assertTrue(action.isSurveyCompleted(952));
		assertEquals(1, action.getLabs().size());
		action.representPatient("1");
		assertEquals(1L, action.getPatient().getMID());
		assertTrue(action.doesFamilyMemberHaveHighBP(fmBean));
		assertTrue(action.doesFamilyMemberHaveDiabetes(fmBean));
		assertTrue(action.isFamilyMemberSmoker(fmBean));
		assertFalse(action.doesFamilyMemberHaveCancer(fmBean));
		assertFalse(action.doesFamilyMemberHaveHighCholesterol(fmBean));
		assertFalse(action.doesFamilyMemberHaveHeartDisease(fmBean));
		assertTrue(action.getFamilyMemberCOD(fmBean).contains("Diabetes"));
		assertEquals(5, new ViewMyRecordsAction(factory, 5L).getFamilyHistory().size());
	}
	
	public void testRepresentPatient() throws ITrustException {
		String StrRep = "3";
		long longRep = (new Long(StrRep)).longValue();
		long mid = action.representPatient("3");
		assertEquals(longRep, mid);
		
		try {
			mid = action.representPatient("Three");
			fail();
		} catch(ITrustException e) {
			assertEquals(e.getMessage(), "MID is not a number");
		}
	}

	public void testGetPersonnel() throws ITrustException {
		PersonnelBean pBean = action.getPersonnel(hcpId);
		
		assertEquals(hcpId, pBean.getMID());
	}
	
	public void testGetAllOfficeVisits() throws ITrustException {
		List<OfficeVisitBean> ovbList = action.getAllOfficeVisits();
		
		assertEquals(12, ovbList.size());
	}
	
	public void testGetRepresented() throws ITrustException {
		List<PatientBean> pbList = action.getRepresented();
		
		assertEquals(6, pbList.size());
	}

	public void testGetRepresenting() throws ITrustException {
		List<PatientBean> pbList = action.getRepresenting();
		
		assertEquals(0, pbList.size());
	}
	
	public void testGetLabs() throws ITrustException {
		List<LabProcedureBean> lpbList = action.getLabs();
		
		assertEquals(1, lpbList.size());
	}
	
	public void testDoesFamilyMemberHaveHighBP() throws ITrustException {
		assertTrue(action.doesFamilyMemberHaveHighBP(fmBean));
	}
	
	public void testDoesFamilyMemberHaveCancer() throws ITrustException {
		assertFalse(action.doesFamilyMemberHaveCancer(fmBean));
	}

	public void testDoesFamilyMemberHaveHeartDisease() throws ITrustException {
		assertFalse(action.doesFamilyMemberHaveHeartDisease(fmBean));
	}

	public void testGetFamilyMemberCOD() throws ITrustException {
		assertEquals("Diabetes with ketoacidosis", action.getFamilyMemberCOD(fmBean));
	}
	
	public void testGetSpecificLabs() throws ITrustException {
		List<LabProcedureBean> lpbList = action.getSpecificLabs(pid, "10640-1");
		
		assertEquals(1, lpbList.size());
	}
}
