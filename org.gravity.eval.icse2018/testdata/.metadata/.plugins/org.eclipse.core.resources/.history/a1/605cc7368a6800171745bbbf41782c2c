package edu.ncsu.csc.itrust.unit.dao.officevisit;

import java.util.Arrays;
import java.util.List;

import junit.framework.TestCase;
import edu.ncsu.csc.itrust.beans.PrescriptionReportBean;
import edu.ncsu.csc.itrust.dao.mysql.PrescriptionReportDAO;
import edu.ncsu.csc.itrust.unit.datagenerators.TestDataGenerator;
import edu.ncsu.csc.itrust.unit.testutils.TestDAOFactory;

/**
 * Test  prescriptions
 */
public class GetPrescriptionsTest extends TestCase {
	private PrescriptionReportDAO preportDAO = TestDAOFactory.getTestInstance().getPrescriptionReportDAO();
	private TestDataGenerator gen;

	@Override
	protected void setUp() throws Exception {
		gen = new TestDataGenerator();
		gen.clearAllTables();
		gen.patient2();
		gen.hcp0();
		gen.hospitals();
		gen.ndCodes();
	}

	/**
	 * testGetPrescriptions
	 * @throws Exception
	 */
	public void testGetPrescriptions() throws Exception {
		List<Long> ovIDs = Arrays.asList(955L, 952L);
		List<PrescriptionReportBean> prescriptions = preportDAO.byOfficeVisitAndPatient(ovIDs, 2L);
		for (int i=0; i<3; i++)
		{
			if (prescriptions.get(i).getPrescription()
				.getMedication().getNDCode().equals("009042407"))
			{
			assertPrescription(prescriptions.get(i));
			}
			else if (prescriptions.get(i).getPrescription()
				.getMedication().getNDCode().equals("647641512"))
			{
			assertPrescription2(prescriptions.get(i));
			}
			else
			{
				fail("This prescription should not be in database");
			}
		}
		
	}

	/**
	 * testGetWithNotRightPID
	 * @throws Exception
	 */
	public void testGetWithNotRightPID() throws Exception {
		List<Long> ovIDs = Arrays.asList(5L, 2L);
		List<PrescriptionReportBean> prescriptions = preportDAO.byOfficeVisitAndPatient(ovIDs, 1L); // injection!
		assertEquals(0, prescriptions.size());
	}
}
