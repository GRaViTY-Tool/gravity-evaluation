package edu.ncsu.csc.itrust.unit.action;

import java.util.List;

import junit.framework.TestCase;
import edu.ncsu.csc.itrust.action.LabProcHCPAction;
import edu.ncsu.csc.itrust.beans.LabProcedureBean;
import edu.ncsu.csc.itrust.dao.DAOFactory;
import edu.ncsu.csc.itrust.dao.mysql.FakeEmailDAO;
import edu.ncsu.csc.itrust.dao.mysql.LabProcedureDAO;
import edu.ncsu.csc.itrust.dao.mysql.OfficeVisitDAO;
import edu.ncsu.csc.itrust.unit.datagenerators.TestDataGenerator;
import edu.ncsu.csc.itrust.unit.testutils.TestDAOFactory;

public class LabProcHCPActionTest extends TestCase {

	private DAOFactory factory = TestDAOFactory.getTestInstance();
	private LabProcedureDAO lpDAO = factory.getLabProcedureDAO();
	private OfficeVisitDAO ovDAO = factory.getOfficeVisitDAO();
	private FakeEmailDAO feDAO = factory.getFakeEmailDAO();
	private TestDataGenerator gen;
	LabProcHCPAction action;
	LabProcHCPAction action2;
	
	@Override
	protected void setUp() throws Exception {
		gen = new TestDataGenerator();
		gen.clearAllTables();
		gen.transactionLog();
		gen.patient1();
		gen.patient2();
		gen.patient3();
		gen.patient4();
		gen.hcp0();
		gen.hcp3();
		gen.labProcedures();
		action = new LabProcHCPAction(factory, 9000000000L);
	}

	public void testViewProcedure() throws Exception {
		LabProcedureBean lp = new LabProcedureBean();
		lp.setLoinc("10763-1");
		lp.setCommentary("This is a routine procedure");
		lp.setOvID(902L);
		lp.setPid(3L);
		lp.setResults("");
		lp.allow();
		lp.statusPending();
		long id = lpDAO.addLabProcedure(lp);
		List<LabProcedureBean> procedures = action.viewProcedures(3L);
		assertEquals(1, procedures.size());
		assertEquals(id, procedures.get(0).getProcedureID());
	}

	public void testGetLabProcedureForLHCPForNextMonth1() throws Exception {
		action2 = new LabProcHCPAction(factory, 9000000003L);
		List<LabProcedureBean> procedures = action2.getLabProcForNextMonth();
		assertNotNull(procedures);
	}
}
