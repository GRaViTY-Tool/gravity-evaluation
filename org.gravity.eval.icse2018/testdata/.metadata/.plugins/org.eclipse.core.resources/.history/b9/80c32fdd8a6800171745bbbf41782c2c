package net.sf.jabref.plugin.core.generated;

import java.net.URL;
import java.util.ArrayList;
import java.util.Collection;
import java.util.HashMap;
import java.util.List;

import net.sf.jabref.BibtexEntry;
import net.sf.jabref.Globals;
import net.sf.jabref.export.layout.LayoutFormatter;
import net.sf.jabref.imports.EntryFetcher;
import net.sf.jabref.imports.ImportInspectionCommandLine;
import net.sf.jabref.imports.ParserResult;
import net.sf.jabref.plugin.PluginCore;
import net.sf.jabref.plugin.core.JabRefPlugin;
import net.sf.jabref.plugin.util.RuntimeExtension;
import org.java.plugin.Plugin;
import org.java.plugin.PluginLifecycleException;
import org.java.plugin.registry.Extension;
import org.java.plugin.registry.ExtensionPoint;

import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;

/**
 * Do not modify this file, as it was auto generated and will be overwritten!
 * User modifications should go in net.sf.jabref.plugin.core.JabRefPlugin.
 */
public abstract class _JabRefPlugin extends Plugin {

    public static String getId(){
        return "net.sf.jabref.core";
    }

	static Log log = LogFactory.getLog(_JabRefPlugin.class);

	public List<ExportFormatTemplateExtension> getExportFormatTemplateExtensions(){
        ExtensionPoint extPoint = getManager().getRegistry().getExtensionPoint(getId(), "ExportFormatTemplate");
        List<ExportFormatTemplateExtension> result = new ArrayList<ExportFormatTemplateExtension>();
        for (Extension ext : extPoint.getConnectedExtensions()) {
			try {
				result.add(new ExportFormatTemplateExtension(getManager().getPlugin(
						ext.getDeclaringPluginDescriptor().getId()), ext));
			} catch (PluginLifecycleException e) {
				log.error("Failed to activate plug-in " + ext.getDeclaringPluginDescriptor().getId(), e);
			}
		}
        return result;
    }

    public static class ExportFormatTemplateExtension extends RuntimeExtension {
        public ExportFormatTemplateExtension(Plugin declaringPlugin, Extension wrapped){
            super(declaringPlugin, wrapped);
        }
                
	     
              public String getDisplayName(){
            return getStringParameter("displayName");
        }
  
  	     
              public String getConsoleName(){
            return getStringParameter("consoleName");
        }
  
  	     
              public String getLayoutFilename(){
            return getStringParameter("layoutFilename");
        }
  
  	     
      		public URL getDirAsUrl(){
		    return getResourceParameter("dir");
		}
		
		public URL getDirAsUrl(String relativePath){
		    return getResourceParameter("dir", relativePath);
		}
  
  	     
              public String getExtension(){
            return getStringParameter("extension");
        }
  
  	     
              public String getEncoding(){
            return getStringParameter("encoding");
        }
  
      }

	public List<ExportFormatExtension> getExportFormatExtensions(){
        ExtensionPoint extPoint = getManager().getRegistry().getExtensionPoint(getId(), "ExportFormat");
        List<ExportFormatExtension> result = new ArrayList<ExportFormatExtension>();
        for (Extension ext : extPoint.getConnectedExtensions()) {
			try {
				result.add(new ExportFormatExtension(getManager().getPlugin(
						ext.getDeclaringPluginDescriptor().getId()), ext));
			} catch (PluginLifecycleException e) {
				log.error("Failed to activate plug-in " + ext.getDeclaringPluginDescriptor().getId(), e);
			}
		}
        return result;
    }

    public static class ExportFormatExtension extends RuntimeExtension {
        public ExportFormatExtension(Plugin declaringPlugin, Extension wrapped){
            super(declaringPlugin, wrapped);
        }
                
	     
              /**
         * @return A singleton instance of the class parameter or null if the class could not be found!
         */
        public net.sf.jabref.export.IExportFormat getExportFormat(){
          return (net.sf.jabref.export.IExportFormat)getClassParameter("exportFormat");
        }
  
  	     
              public String getDisplayName(){
            return getStringParameter("displayName");
        }
  
  	     
              public String getConsoleName(){
            return getStringParameter("consoleName");
        }
  
  	     
              public String getExtension(){
            return getStringParameter("extension");
        }
  
      }

	public List<SidePanePluginExtension> getSidePanePluginExtensions(){
        ExtensionPoint extPoint = getManager().getRegistry().getExtensionPoint(getId(), "SidePanePlugin");
        List<SidePanePluginExtension> result = new ArrayList<SidePanePluginExtension>();
        for (Extension ext : extPoint.getConnectedExtensions()) {
			try {
				result.add(new SidePanePluginExtension(getManager().getPlugin(
						ext.getDeclaringPluginDescriptor().getId()), ext));
			} catch (PluginLifecycleException e) {
				log.error("Failed to activate plug-in " + ext.getDeclaringPluginDescriptor().getId(), e);
			}
		}
        return result;
    }

    public static class SidePanePluginExtension extends RuntimeExtension {
        public SidePanePluginExtension(Plugin declaringPlugin, Extension wrapped){
            super(declaringPlugin, wrapped);
        }
                
	     
              /**
         * @return A singleton instance of the class parameter or null if the class could not be found!
         */
        public net.sf.jabref.plugin.SidePanePlugin getSidePanePlugin(){
          return (net.sf.jabref.plugin.SidePanePlugin)getClassParameter("sidePanePlugin");
        }
  
  	     
              public String getName(){
            return getStringParameter("name");
        }
  
  	     
              public String getDescription(){
            return getStringParameter("description");
        }
  
      }

	public List<EntryFetcherExtension> getEntryFetcherExtensions(){
        ExtensionPoint extPoint = getManager().getRegistry().getExtensionPoint(getId(), "EntryFetcher");
        List<EntryFetcherExtension> result = new ArrayList<EntryFetcherExtension>();
        for (Extension ext : extPoint.getConnectedExtensions()) {
			try {
				result.add(new EntryFetcherExtension(getManager().getPlugin(
						ext.getDeclaringPluginDescriptor().getId()), ext));
			} catch (PluginLifecycleException e) {
				log.error("Failed to activate plug-in " + ext.getDeclaringPluginDescriptor().getId(), e);
			}
		}
        return result;
    }

    public static class EntryFetcherExtension extends RuntimeExtension {
        public EntryFetcherExtension(Plugin declaringPlugin, Extension wrapped){
            super(declaringPlugin, wrapped);
        }
                
	     
              /**
         * @return A singleton instance of the class parameter or null if the class could not be found!
         */
        public net.sf.jabref.imports.EntryFetcher getEntryFetcher(){
          return (net.sf.jabref.imports.EntryFetcher)getClassParameter("entryFetcher");
        }
  
  	     
              public String getName(){
            return getStringParameter("name");
        }
  
  	     
              public String getDescription(){
            return getStringParameter("description");
        }
  
      }

	public List<ExportFormatProviderExtension> getExportFormatProviderExtensions(){
        ExtensionPoint extPoint = getManager().getRegistry().getExtensionPoint(getId(), "ExportFormatProvider");
        List<ExportFormatProviderExtension> result = new ArrayList<ExportFormatProviderExtension>();
        for (Extension ext : extPoint.getConnectedExtensions()) {
			try {
				result.add(new ExportFormatProviderExtension(getManager().getPlugin(
						ext.getDeclaringPluginDescriptor().getId()), ext));
			} catch (PluginLifecycleException e) {
				log.error("Failed to activate plug-in " + ext.getDeclaringPluginDescriptor().getId(), e);
			}
		}
        return result;
    }

    public static class ExportFormatProviderExtension extends RuntimeExtension {
        public ExportFormatProviderExtension(Plugin declaringPlugin, Extension wrapped){
            super(declaringPlugin, wrapped);
        }
                
	     
              /**
         * @return A singleton instance of the class parameter or null if the class could not be found!
         */
        public net.sf.jabref.export.IExportFormatProvider getFormatProvider(){
          return (net.sf.jabref.export.IExportFormatProvider)getClassParameter("formatProvider");
        }
  
  	     
              public String getName(){
            return getStringParameter("name");
        }
  
  	     
              public String getDescription(){
            return getStringParameter("description");
        }
  
      }

	public List<PushToApplicationExtension> getPushToApplicationExtensions(){
        ExtensionPoint extPoint = getManager().getRegistry().getExtensionPoint(getId(), "PushToApplication");
        List<PushToApplicationExtension> result = new ArrayList<PushToApplicationExtension>();
        for (Extension ext : extPoint.getConnectedExtensions()) {
			try {
				result.add(new PushToApplicationExtension(getManager().getPlugin(
						ext.getDeclaringPluginDescriptor().getId()), ext));
			} catch (PluginLifecycleException e) {
				log.error("Failed to activate plug-in " + ext.getDeclaringPluginDescriptor().getId(), e);
			}
		}
        return result;
    }

    public static class PushToApplicationExtension extends RuntimeExtension {
        public PushToApplicationExtension(Plugin declaringPlugin, Extension wrapped){
            super(declaringPlugin, wrapped);
        }
                
	     
              /**
         * @return A singleton instance of the class parameter or null if the class could not be found!
         */
        public net.sf.jabref.external.PushToApplication getPushToApp(){
          return (net.sf.jabref.external.PushToApplication)getClassParameter("pushToApp");
        }
  
  	     
              public String getName(){
            return getStringParameter("name");
        }
  
  	     
              public String getDescription(){
            return getStringParameter("description");
        }
  
      }

	public List<LayoutFormatterExtension> getLayoutFormatterExtensions(){
        ExtensionPoint extPoint = getManager().getRegistry().getExtensionPoint(getId(), "LayoutFormatter");
        List<LayoutFormatterExtension> result = new ArrayList<LayoutFormatterExtension>();
        for (Extension ext : extPoint.getConnectedExtensions()) {
			try {
				result.add(new LayoutFormatterExtension(getManager().getPlugin(
						ext.getDeclaringPluginDescriptor().getId()), ext));
			} catch (PluginLifecycleException e) {
				log.error("Failed to activate plug-in " + ext.getDeclaringPluginDescriptor().getId(), e);
			}
		}
        return result;
    }

    public static class LayoutFormatterExtension extends RuntimeExtension {
        public LayoutFormatterExtension(Plugin declaringPlugin, Extension wrapped){
            super(declaringPlugin, wrapped);
        }
                
	     
              /**
         * @return A singleton instance of the class parameter or null if the class could not be found!
         */
        public net.sf.jabref.export.layout.LayoutFormatter getLayoutFormatter(){
          return (net.sf.jabref.export.layout.LayoutFormatter)getClassParameter("layoutFormatter");
        }
  
  	     
              public String getDescription(){
            return getStringParameter("description");
        }
  
  	     
              public String getName(){
            return getStringParameter("name");
        }
  
      }

	public List<ImportFormatExtension> getImportFormatExtensions(){
        ExtensionPoint extPoint = getManager().getRegistry().getExtensionPoint(getId(), "ImportFormat");
        List<ImportFormatExtension> result = new ArrayList<ImportFormatExtension>();
        for (Extension ext : extPoint.getConnectedExtensions()) {
			try {
				result.add(new ImportFormatExtension(getManager().getPlugin(
						ext.getDeclaringPluginDescriptor().getId()), ext));
			} catch (PluginLifecycleException e) {
				log.error("Failed to activate plug-in " + ext.getDeclaringPluginDescriptor().getId(), e);
			}
		}
        return result;
    }

    /**
	 * Run an entry fetcher from the command line.
	 * 
	 * Note that this only works headlessly if the EntryFetcher does not show
	 * any GUI.
	 * 
	 * @param fetchCommand
	 *            A string containing both the fetcher to use (id of
	 *            EntryFetcherExtension minus Fetcher) and the search query,
	 *            separated by a :
	 * @return A parser result containing the entries fetched or null if an
	 *         error occurred.
	 */
	protected ParserResult fetch(String fetchCommand) {
	
	    if (fetchCommand == null || !fetchCommand.contains(":") ||
	        fetchCommand.split(":").length != 2) {
	        System.out.println(Globals.lang("Expected syntax for --fetch='<name of fetcher>:<query>'"));
	        System.out.println(Globals.lang("The following fetchers are available:"));
	        return null;
	    }
	
	    String engine = fetchCommand.split(":")[0];
	    String query = fetchCommand.split(":")[1];
	
	    EntryFetcher fetcher = null;
	    for (EntryFetcherExtension e : JabRefPlugin.getInstance(PluginCore.getManager())
	        .getEntryFetcherExtensions()) {
	        if (engine.toLowerCase().equals(e.getId().replaceAll("Fetcher", "").toLowerCase()))
	            fetcher = e.getEntryFetcher();
	    }
	
	    if (fetcher == null) {
	        System.out.println(Globals.lang("Could not find fetcher '%0'", engine));
	        System.out.println(Globals.lang("The following fetchers are available:"));
	        for (EntryFetcherExtension e : JabRefPlugin.getInstance(PluginCore.getManager())
	            .getEntryFetcherExtensions()) {
	            System.out.println("  " + e.getId().replaceAll("Fetcher", "").toLowerCase());
	        }
	        return null;
	    }
	
	    System.out.println(Globals.lang("Running Query '%0' with fetcher '%1'.", query, engine) +
	        " " + Globals.lang("Please wait!"));
	    Collection<BibtexEntry> result = new ImportInspectionCommandLine().query(query, fetcher);
	
	    if (result == null || result.size() == 0) {
	        System.out.println(Globals.lang(
	            "Query '%0' with fetcher '%1' did not return any results.", query, engine));
	        return null;
	    }
	
	    return new ParserResult(result);
	}

	public static LayoutFormatter getLayoutFormatterFromPlugins(String formatterName){
		if (pluginLayoutFormatter == null){
			pluginLayoutFormatter = new HashMap<String, LayoutFormatter>();
	        JabRefPlugin plugin = JabRefPlugin.getInstance(PluginCore.getManager());
			if (plugin != null){
				for (LayoutFormatterExtension e : plugin.getLayoutFormatterExtensions()){
					LayoutFormatter formatter = e.getLayoutFormatter();
					String name = e.getName();
					if (name == null)
						name = e.getId();
					
					if (formatter != null){
						pluginLayoutFormatter.put(name, formatter);
					}
				}
			}
		}
	    // We need to make a new instance of this LayoutFormatter, in case it is a
	    // parameter-accepting layout formatter:
	    if (pluginLayoutFormatter.containsKey(formatterName)) {
	        Class<? extends LayoutFormatter> c = pluginLayoutFormatter.get(formatterName).getClass();
	        try {
	            return c.getConstructor().newInstance();
	        } catch (Throwable e) {
	            e.printStackTrace();
	        }
	        return pluginLayoutFormatter.get(formatterName);
	    }
	    else return null;
	}

	public static class ImportFormatExtension extends RuntimeExtension {
        public ImportFormatExtension(Plugin declaringPlugin, Extension wrapped){
            super(declaringPlugin, wrapped);
        }
                
	     
              /**
         * @return A singleton instance of the class parameter or null if the class could not be found!
         */
        public net.sf.jabref.imports.ImportFormat getImportFormat(){
          return (net.sf.jabref.imports.ImportFormat)getClassParameter("importFormat");
        }
  
  	     
              public String getName(){
            return getStringParameter("name");
        }
  
  	     
              public String getDescription(){
            return getStringParameter("description");
        }
  
      }

}
