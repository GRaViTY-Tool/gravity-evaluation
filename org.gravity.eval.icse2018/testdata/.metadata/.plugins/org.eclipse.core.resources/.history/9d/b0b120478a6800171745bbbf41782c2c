package edu.ncsu.csc.itrust.unit.action;

import junit.framework.TestCase;
import edu.ncsu.csc.itrust.action.EditHealthHistoryAction;
import edu.ncsu.csc.itrust.beans.forms.HealthRecordForm;
import edu.ncsu.csc.itrust.dao.DAOFactory;
import edu.ncsu.csc.itrust.exception.DBException;
import edu.ncsu.csc.itrust.exception.ITrustException;
import edu.ncsu.csc.itrust.unit.datagenerators.TestDataGenerator;
import edu.ncsu.csc.itrust.unit.testutils.EvilDAOFactory;
import edu.ncsu.csc.itrust.unit.testutils.TestDAOFactory;

public class EditHealthHistoryActionTest extends TestCase {
	private DAOFactory factory = TestDAOFactory.getTestInstance();
	private TestDataGenerator gen;
	private EditHealthHistoryAction action;

	@Override
	protected void setUp() throws Exception {
		gen = new TestDataGenerator();
		gen.clearAllTables();
		gen.patient1();
		gen.patient2();
		gen.uc51();
		action = new EditHealthHistoryAction(factory, 9000000000L, "2");
	}
		
	public void testPatientNameNull() throws Exception {
		assertNotNull(action.getPatientName());
	}

	public void testAddHealthRecordEvil() throws Exception {
		//Correct form data
		HealthRecordForm hr = new HealthRecordForm();
		hr.setBloodPressureN("999");
		hr.setBloodPressureD("999");
		hr.setCholesterolHDL("50");
		hr.setCholesterolLDL("50");
		hr.setCholesterolTri("499");
		hr.setHeight("65.2");
		hr.setWeight("9999.9");
		hr.setIsSmoker("1");
		action = new EditHealthHistoryAction(new EvilDAOFactory(1), 9000000000L, "2");
		action.setPatientAge(200);
		try {
			action.addHealthRecord(1L, hr, 0);
		} catch (ITrustException e) {
			DBException dbe = (DBException) e;
			assertEquals(EvilDAOFactory.MESSAGE, dbe.getSQLException().getMessage());
		}
	}
}
